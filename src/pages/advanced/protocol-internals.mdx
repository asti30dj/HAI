# Protocol Internals

Documentation of certain protocol elements, intended for **internal use only.**

## Universal Link

The universal link is used so that the World App can recognize a World ID request and handle it correctly. As more clients are built, the universal link will be extended to other wallets. The structure of the universal link is documented here. The source of truth function for this can be found [on GitHub](https://github.com/worldcoin/idkit-js/blob/dc4a3fe33d3d9f77ef700bc3493a4b8ce2a897fd/idkit/src/lib/qr.ts#L4), `buildQRData` function.

- The universal link base is: `https://worldcoin.org/verify`.
  - There is one **required** query string, `w`, which contains the [WalletConnect URI](https://docs.walletconnect.com/2.0/javascript/sign/wallet-usage#uri)
  - There is one **optional** query string, `r`, which contains a return URL for mobile app verifications

According to guidance from the WalletConnect team, only v2 URIs are supported.

## External Nullifier

World ID actions (whether for Sign In, custom, or anonymous actions) are identified by their [external nullifier](TODO). This value is derived from the `app_id` and stringified action passed by IDKit to the World app. Our implementation can be [found here](https://github.com/worldcoin/idkit-js/blob/dc4a3fe33d3d9f77ef700bc3493a4b8ce2a897fd/idkit/src/lib/hashing.ts#L94).

When performing a request to the `/precheck` endpoint, it may be more convinent to calculate this value in-flight. The following is a simple script to accomplish this:

```js
TODO
```

## OpenID Connect Claims

Within the ID token returned by the World ID provider, a minimal number of [OIDC claims](https://openid.net/specs/openid-connect-core-1_0.html#IDToken) are set. This is due to the privacy-focused nature of the protocol. The set claims are:

- `iss`: The issuer of the token, always "https://id.worldcoin.org"
- `sub`: The unique user identifier that this token authenticates, set as the `nullifier_hash`
- `aud`: The identifier of the requesting application, set as `app_id` from the developer portal or `register` endpoint
- `jti`: A unique identifer for this ID token, only used once
- `iat`: The timestamp of the token issuance
- `exp`: The timestamp of the token's expiration
- `alg`: The algorithm used to sign the ID token, only RS256 is supported
- `scope`: The scopes requested by the application. Must always contain `openid`, and optionally `profile` and `email`
- `https://worldcoin.org/beta`: A custom claim for describing the user's verification level. **Subject to change**
  - `likely_human`: "strong" or "weak", corresponding to whether the user has been verified by an Orb
  - `credential_type`: "orb" or "phone", corresponding to the highest level of verification completed by the user
