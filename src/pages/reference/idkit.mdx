# IDKit

<Note>
	IDKit is open source and accepts contributions! Head over to [GitHub](https://github.com/worldcoin/idkit-js) and
	submit a pull request.
</Note>

There are three packages available in the IDKit Monorepo: `@worldcoin/idkit`, `@worldcoin/idkit-standalone`, and `@worldcoin/idkit-core`. The `@worldcoin/idkit` package is the main package that should be used with the React JS framework. The `@worldcoin/idkit-standalone` package is a standalone package that can be used in vanilla JavaScript applications. The `@worldcoin/idkit-core` package is a core functionality package that is used by the other two packages, and should be used when creating a new IDKit package.

## IDKit (React)

The `@worldcoin/idkit` package is the main package that should be used with the [React framework](https://react.dev/) or any other framework that supports React components, such as [Next.JS](https://nextjs.org/).

### Components

#### `IDKitWidget`

The `IDKitWidget` component is the main component that renders the World ID widget. It should be mounted in your React app and passed the relevant parameters. Accepts a function as a child that receives an `open` function to open the widget.

```jsx
import { IDKitWidget } from '@worldcoin/idkit'

<IDKitWidget
	app_id="app_GBkZ1KlVUdFTjeMXKlVUdFT" // obtained from the Developer Portal
	action="vote_1" // this is your action name from the Developer Portal
	signal="user_value" // any arbitrary value the user is committing to, e.g. a vote
	onSuccess={onSuccess}
	credential_types={['orb', 'device']} // the credentials you want to accept
>
	{({ open }) => <button onClick={open}>Verify with World ID</button>}
</IDKitWidget>
```

### Parameters

The following parameters can be passed as props to the `IDKitWidget` component:

<Properties>
	<Property name="app_id" type="string" required={true}>
		Unique identifier for the app verifying the action. This should be the App ID obtained from the [Developer
		Portal](https://developer.worldcoin.org).
	</Property>
	<Property name="action" type="string" required={true}>
        Identifier for the action the user is performing. This should be the action name set in the Developer Portal.
	</Property>
	<Property name="onSuccess" type="function" required={true}>
		Function to trigger when verification is successful and the modal is closed. Should receive a single parameter of type `ISuccessResult`
		which contains [the proof details.](#response)
	</Property>
	<Property name="handleVerify" type="function">
		Called after the proof is returned from the World App, but before showing the success screen. Throwing an error in this
		screen will show the user a custom error. Used to perform additional validation when needed.
	</Property>
	<Property name="credential_types" type="string[]" defaultValue='["orb"]'>
		An array of credential types to allow for verification. Will accept any combination of `orb` & `device`. Defaults
		to `"orb"`. **TypeScript apps can use the `CredentialType` enum.**
	</Property>
	<Property name="signal" type="string" defaultValue='""'>
		The signal to be included in the zero-knowledge proof. Typically used for on-chain actions, read more in [the On-chain section](/id/on-chain).
	</Property>
	<Property name="bridge_url" type="string" defaultValue='"https://bridge.worldcoin.org"'>
		The URL of the [Wallet Bridge](https://github.com/worldcoin/wallet-bridge) to use for establishing a connection between IDKit and the user's World ID Wallet. Defaults to the bridge service hosted by Worldcoin. 
		**Only change this if you are running your own bridge service.** Read more in [Protocol Internals](/further-reading/protocol-internals).
	</Property>
	<Property name="action_description" type="string">
		The description of the specific action (shown to users in World App). **Only used for Dynamic Actions.**
	</Property>
	<Property name="theme" type='"light" | "dark"' defaultValue='"light"'>
		The theme to apply to the widget's UI. Defaults to `"light"`.
	</Property>
	<Property name="autoClose" type="boolean" defaultValue="true">
		Whether to automatically close the widget after completion. Defaults to `true`.
	</Property>
</Properties>

### Hooks

#### `useIDKit`

The `useIDKit` hook allows you to programmatically open the IDKit widget without mounting any buttons on screen. Note that you still need to mount the component for this to work.

```jsx focus=1,3,6,11
import { useIDKit } from '@worldcoin/idkit'

const { open, setOpen } = useIDKit()

useEffect(() => {
	setOpen(true)
}, [])

return (
	<div>
		<IDKitWidget app_id="..." action="..." />
	</div>
)
```

### Response

Upon successful completion of the World ID flow, you will receive a response object. This response object of type `ISuccessResult` has the following attributes. **Normally, you will forward these parameters to your backend or smart contract for verification.**

<Properties>
	<Property name="merkle_root" type="string">
		This is the hash pointer to the root of the Merkle tree that proves membership of the user's identity in the
		list of identities verified by the Orb. ABI encoded.
	</Property>
	<Property name="nullifier_hash" type="string">
		Essentially the user's unique identifier for your app (and specific action if using Anonymous actions). ABI
		encoded.
	</Property>
	<Property name="proof" type="string">
		The Zero-knowledge proof of the verification. ABI encoded.
	</Property>
	<Property name="credential_type" type='"orb" | "device"'>
		Either `orb` or `device`. Will always return the strongest credential with which a user has been verified.
	</Property>
</Properties>

### Error Handling

Errors in the JS package will generally be returned in the Promise rejection of the [`.init()`](/reference/idkit#init) method. In exceptional cases, some errors may be thrown in the Javascript console (though this is mostly for unhandled errors, and is not normal behavior).

The `errorResult` object that is returned in the Promise rejection has the following structure:

```json
{
	"code": "already_signed",
	"detail": "User has previously signed and submitted proof for this action."
}
```

<Note>When debugging, check the Javascript console for any additional details.</Note>

#### Error codes

The JS package may return any of the following error codes.

<table>
	<thead>
		<tr>
			<th>Code</th>
			<th>Description</th>
			<th>How to fix?</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>`connection_failed`</td>
			<td>Could not establish a connection to the WLD app.</td>
			<td>
				Ask the user to check their internet connection on both devices running your dapp and their WLD app.
				Additionally, make sure the user has the latest WLD app version.
			</td>
		</tr>
		<tr>
			<td>`verification_rejected`</td>
			<td>User rejected the World ID request in their WLD app.</td>
			<td>If this was a mistake, ask the user to go through the flow again.</td>
		</tr>
		<tr>
			<td>`already_signed`</td>
			<td>This person has already submitted a proof for the particular action.</td>
			<td>Nothing to do. User cannot submit a request for the same action twice.</td>
		</tr>
		<tr>
			<td>`invalid_action_id`</td>
			<td>The action ID provided to IDKit is not valid.</td>
			<td>Check the action ID. Make sure it's a valid string.</td>
		</tr>
		<tr>
			<td>`invalid_signal`</td>
			<td>The signal provided to IDKit is not valid.</td>
			<td>Check the signal. Make sure it's a valid string or address.</td>
		</tr>
		<tr>
			<td>`unexpected_response`</td>
			<td>There was a problem with the response obtained from the WLD app.</td>
			<td>
				Check the JS console for further details, though in most cases these will require contacting us to
				report the bug.
			</td>
		</tr>
		<tr>
			<td>`generic_error`</td>
			<td>An unhandled exception occurred.</td>
			<td>
				Check the JS console for further details, though in most cases these will require contacting us to
				report the bug.
			</td>
		</tr>
	</tbody>
</table>

## IDKit Standalone

The `@worldcoin/idkit-standalone` package is intended for vanilla JS applications. It is a standalone package that acts as a wrapper around the `@worldcoin/idkit` package.

### Methods

<Note>
	The `.init()` and `.update()` methods take the same parameters as the React package's IDKitWidget component. See [above](#id-kit-react) for more details.
</Note>

#### .init()

The `.init()` method is the main initialization method used for vanilla JS apps. It should be called to start up IDKit and configure the widget.

{/* cSpell:disable */}

```js
import { IDKit } from '@worldcoin/idkit-standalone'

const onSuccess = (result) => {
	// handle success
}

IDKit.init({
	app_id: 'app_lshSNnaJfdt6Sohu6YAA',
	action: 'my_action',
	onSuccess: onSuccess,
})
```

{/* cSpell:enable */}

#### .update()

The `.update()` method reinitializes the widget with new parameters. It can only be called after the `.init()` method.

{/* cSpell:disable */}

```js
IDKit.update({
	app_id: 'app_lshSNnaJfdt6Sohu6YAA',
	action: 'my_new_action',
	onSuccess: onSuccess,
})
```

{/* cSpell:enable */}

#### .open()

The `.open()` method is used to open the widget. It can only be called after the `.init()` method, typically in response to a button click.

```js
IDKit.open()
```