# IDKit

<Note>
	IDKit is open source and accepts contributions! Head over to [GitHub](https://github.com/worldcoin/idkit-js) and
	submit a pull request.
</Note>

There are three packages available in the IDKit Monorepo: `@worldcoin/idkit`, `@worldcoin/idkit-standalone`, and `@worldcoin/idkit-core`. The `@worldcoin/idkit` package is the main package that should be used with the React JS framework. The `@worldcoin/idkit-standalone` package is a standalone package that can be used in vanilla JavaScript applications. The `@worldcoin/idkit-core` package is a core functionality package that is used by the other two packages, and should be used only when creating a new IDKit package.

## IDKit (React)

The `@worldcoin/idkit` package is the main package that should be used with the [React framework](https://react.dev/) or any other framework that supports React components, such as [Next.JS](https://nextjs.org/).

### Components

#### `IDKitWidget`

The `IDKitWidget` component is the main component that renders the World ID widget. It should be mounted in your React app and passed the relevant parameters. Accepts a function as a child that receives an `open` function to open the widget.

```jsx
import { IDKitWidget } from '@worldcoin/idkit'

<IDKitWidget
	app_id="app_GBkZ1KlVUdFTjeMXKlVUdFT" // obtained from the Developer Portal
	action="vote_1" // this is your action name from the Developer Portal
	signal="user_value" // any arbitrary value the user is committing to, e.g. a vote
	onSuccess={onSuccess}
	credential_types={['orb', 'device']} // the credentials you want to accept
>
	{({ open }) => <button onClick={open}>Verify with World ID</button>}
</IDKitWidget>
```

### Parameters

The following parameters can be passed as props to the `IDKitWidget` component:

<Properties>
	<Property name="app_id" type="string" required={true}>
		Unique identifier for the app verifying the action. This should be the App ID obtained from the [Developer
		Portal](https://developer.worldcoin.org).
	</Property>
	<Property name="action" type="string" required={true}>
        Identifier for the action the user is performing. This should be the action name set in the Developer Portal.
	</Property>
	<Property name="onSuccess" type="function(ISuccessResult)" required={true}>
		Function to trigger when verification is successful and the modal is closed. Should receive a single parameter of type `ISuccessResult`
		which contains [the proof details.](#response)
	</Property>
	<Property name="handleVerify" type="function(ISuccessResult)">
		Called after the proof is returned from the user's identity wallet (e.g. World App), but before showing the success screen. Should receive a single parameter of type `ISuccessResult`
		which contains [the proof details.](#response) Throwing an error in this screen will show the user a custom error.

		<Note>`handleVerify` should be used for API proof verifications to create the best user experience. This will show a pending state while the proof is verified and present any errors thrown in a user-readable fashion.</Note>
	</Property>
	<Property name="onError" type="function(IErrorState)">
		Called when IDKit is closed after an error. Should receive a single parameter of type `IErrorState` which contains [the error details.](#error-handling)
	</Property>
	<Property name="credential_types" type="string[]" defaultValue='["orb"]'>
		An array of credential types to allow for verification. Will accept any combination of `orb` & `device`. Defaults
		to `"orb"`. **TypeScript apps can use the `CredentialType` enum.**
	</Property>
	<Property name="signal" type="string" defaultValue='""'>
		The signal to be included in the zero-knowledge proof. Typically used for on-chain actions, read more in [the On-chain section](/id/on-chain).
	</Property>
	<Property name="bridge_url" type="string" defaultValue='"https://bridge.worldcoin.org"'>
		The URL of the [Wallet Bridge](https://github.com/worldcoin/wallet-bridge) to use for establishing a connection between IDKit and the user's World ID Wallet. Defaults to the bridge service hosted by Worldcoin. 
		**Only change this if you are running your own bridge service.** Read more in [Protocol Internals](/further-reading/protocol-internals#wallet-bridge).
		<Note type="warning">World App will temporarily prevent users from connecting to a Wallet Bridge that is not hosted by Worldcoin or Tools for Humanity while security reviews are ongoing, so we **recommend using the default value** by leaving the `bridge_url` parameter undefined.</Note>
	</Property>
	<Property name="action_description" type="string">
		The description of the specific action (shown to users in World App). **Only used for Dynamic Actions.**
	</Property>
	<Property name="theme" type='"light" | "dark"' defaultValue='"light"'>
		The theme to apply to the widget's UI. Defaults to `"light"`.
	</Property>
	<Property name="autoClose" type="boolean" defaultValue="true">
		Whether to automatically close the widget after completion. Defaults to `true`.
	</Property>
	<Property name="advanced" type="JSON">
		A JSON object containing advanced configuration options that may be unstable or subject to change. See [Advanced Configuration](#advanced-configuration) for more details.
	</Property>
</Properties>

### Hooks

#### `useIDKit`

The `useIDKit` hook allows you to programmatically open the IDKit widget without mounting any buttons on screen. Note that you still need to mount the component for this to work.

```jsx focus=1,3,6,11
import { IDKitWidget, useIDKit } from '@worldcoin/idkit'

const { open, setOpen } = useIDKit()

useEffect(() => {
	setOpen(true)
}, [])

return (
	<div>
		<IDKitWidget app_id="..." action="..." />
	</div>
)
```

### Types

#### `ISuccessResult`

<Properties>
	<Property name="merkle_root" type="string">
		This is the hash pointer to the root of the Merkle tree that proves membership of the user's identity in the
		list of identities verified by the Orb. ABI encoded.
	</Property>
	<Property name="nullifier_hash" type="string">
		Essentially the user's unique identifier for your app (and specific action if using Anonymous actions). ABI
		encoded.
	</Property>
	<Property name="proof" type="string">
		The Zero-knowledge proof of the verification. ABI encoded.
	</Property>
	<Property name="credential_type" type='"orb" | "device"'>
		Either `orb` or `device`. Will always return the strongest credential with which a user has been verified.
	</Property>
</Properties>

```json {{ title: 'ISuccessResult' }}
{
	"merkle_root": "0x1f38b57f3bdf96f05ea62fa68814871bf0ca8ce4dbe073d8497d5a6b0a53e5e0",
	"nullifier_hash": "0x0339861e70a9bdb6b01a88c7534a3332db915d3d06511b79a5724221a6958fbe",
	"proof": "0x063942fd7ea1616f17787d2e3374c1826ebcd2d41d2394...",
	"credential_type": "orb"
}
```

#### `IErrorState`

<Properties>
	<Property name="code" type="string">The error code.</Property>
	<Property name="detail" type="string">
		A human-readable description of the error.
	</Property>
</Properties>

```json {{ title: 'IErrorState' }}
{
	"code": "already_signed",
	"detail": "User has previously signed and submitted proof for this action."
}
```

### Error Handling

An error in IDKit will generally be returned as the input to the `onError` callback. IDKit will display an error to the user and call the `onError` callback with an `IErrorState` object when the modal is closed.

<Note>When debugging, check the Javascript console for any additional details.</Note>

#### Error codes

IDKit may return any of the following error codes to the `onError` callback:

<table>
	<thead>
		<tr>
			<th>Code</th>
			<th>Description</th>
			<th>How to fix?</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>`failed_by_host_app`</td>
			<td>An error was thrown in the `handleVerify` callback.</td>
			<td>
				Assess the error thrown in your `handleVerify` callback and resolve the issue.
			</td>
		</tr>
		<tr>
			<td>`connection_failed`</td>
			<td>Could not establish a connection to World App.</td>
			<td>
				Ask the user to check their internet connection on both devices running your application and World App.
				Additionally, make sure the user has the latest version of World App.
			</td>
		</tr>
		<tr>
			<td>`verification_rejected`</td>
			<td>User rejected the World ID request in World App.</td>
			<td>If this was a mistake, ask the user to go through the flow again.</td>
		</tr>
		<tr>
			<td>`max_verifications_reached`</td>
			<td>This person has already verified for this particular action the maximum number of times allowed.</td>
			<td>Nothing to do. User cannot verify for this action again.</td>
		</tr>
		<tr>
			<td>`credential_unavailable`</td>
			<td>This user does not have the requested credential.</td>
			<td>The user must verify at the Orb or verify their unique device in World App to receive the credential required.</td>
		</tr>
		<tr>
			<td>`malformed_request`</td>
			<td>The request payload couldn't be decrypted or did not conform to the standard.</td>
			<td>Ensure IDKit is configured properly and all parameters are valid. See [above](#id-kit-react) for configuration details.</td>
		</tr>
		<tr>
			<td>`inclusion_proof_failed`</td>
			<td>The sequencer returned an unexpected error when retrieving the inclusion proof.</td>
			<td>Ask the user to try again. This may be due to a temporary network issue, or a bug with World App or the Signup Sequencer.</td>
		</tr>
		<tr>
			<td>`inclusion_proof_pending`</td>
			<td>The user might have the requested credential, but it is not available on-chain yet. It might be available for API verification.</td>
			<td>Ask the user to verify again in approximately one hour.</td>
		</tr>
		<tr>
			<td>`invalid_network`</td>
			<td>The application is configured for a different environment than the verifying user's client.</td>
			<td>Ensure you use the [Worldcoin Simulator](https://simulator.worldcoin.org) for Staging applications and World App for Production applications.</td>
		</tr>
		<tr>
			<td>`metadata_failed`</td>
			<td>Unable to load metadata for the app from the Developer Portal.</td>
			<td>Ensure your `app_id` is configured correctly in IDKit and exactly matches the `app_id` from the Developer Portal.</td>
		</tr>
		<tr>
			<td>`unexpected_response`</td>
			<td>There was a problem with the response obtained from the WLD app.</td>
			<td>
				Check the JS console for further details, though in most cases these will require contacting us to
				report the bug.
			</td>
		</tr>
		<tr>
			<td>`generic_error`</td>
			<td>An unhandled exception occurred.</td>
			<td>
				Check the JS console for further details, though in most cases these will require contacting us to
				report the bug.
			</td>
		</tr>
	</tbody>
</table>

## IDKit Standalone

The `@worldcoin/idkit-standalone` package is intended for vanilla JS applications. It is a standalone package that acts as a wrapper around the `@worldcoin/idkit` package.

### Methods

<Note>
	The `.init()` and `.update()` methods take the same parameters as the React package's IDKitWidget component. See [above](#parameters) for more details.
</Note>

#### .init()

The `.init()` method is the main initialization method used for vanilla JS apps. It should be called to start up IDKit and configure the widget.

{/* cSpell:disable */}

```js
import { IDKit } from '@worldcoin/idkit-standalone'

const onSuccess = (result) => {
	// handle success
}

IDKit.init({
	app_id: 'app_lshSNnaJfdt6Sohu6YAA',
	action: 'my_action',
	onSuccess: onSuccess,
})
```

{/* cSpell:enable */}

#### .update()

The `.update()` method reinitializes the widget with new parameters. It can only be called after the `.init()` method.

{/* cSpell:disable */}

```js
IDKit.update({
	app_id: 'app_lshSNnaJfdt6Sohu6YAA',
	action: 'my_new_action',
	onSuccess: onSuccess,
})
```

{/* cSpell:enable */}

#### .open()

The `.open()` method is used to open the widget. It can only be called after the `.init()` method, typically in response to a button click.

This method returns a Promise object that will resolve when the `onSuccess` callback is called, or reject when the `onError` callback is called.

```js
IDKit.open()
```

## Advanced configuration

This section outlines advanced configuration options that may be unstable or subject to change. These options are passed as a JSON object to the `advanced` prop of the `IDKitWidget` component.

### Self-Hosted Applications

Self-hosted applications bypass the Worldcoin Developer Portal entirely. The proof returned **can not be verified by the Developer Portal API.** Instead, you must verify the proof on-chain or with a custom prover service.

When using self-hosted mode, no `app_id` is required, and any value passed to IDKit will be ignored. The `action` you set must have sufficient uniqueness to avoid collisions with other applications. We recommend using a prefix that includes your application name, e.g. `your_app_name_vote_1`.

```jsx
import { IDKitWidget } from '@worldcoin/idkit'

<IDKitWidget
	// no app_id is set for self-hosted applications
	action="your_app_name_vote_1" // this is your action, set to whatever you'd like
	signal="user_value"
	onSuccess={onSuccess}
	credential_types={['orb']} // only orb credentials are supported for self-hosted applications
	advanced={
		self_hosted, // enable the self-hosted mode
	}
>
	{({ open }) => <button onClick={open}>Verify with World ID</button>}
</IDKitWidget>
```